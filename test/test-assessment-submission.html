<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Assessment Submission</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #0a0e27;
            color: #e0e0e0;
        }
        button {
            background: #dc2626;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: #b91c1c;
        }
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            background: rgba(255,255,255,0.1);
        }
        .success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid #10b981;
        }
        .error {
            background: rgba(220, 38, 38, 0.2);
            border: 1px solid #dc2626;
        }
        pre {
            background: #000;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Assessment Submission Test</h1>
    <p>This page tests the assessment submission flow to ensure data is being saved correctly.</p>

    <div>
        <button onclick="testSubmission()">Submit Test Assessment</button>
        <button onclick="checkCloudData()">Check Cloud Data</button>
        <button onclick="checkLocalData()">Check Local Data</button>
    </div>

    <div id="status" class="status" style="display:none;"></div>

    <script src="../js/assessment-email-backup.js?v=2025100301"></script>
    <script src="../js/security-assessment-jsonbin.js?v=2025100301"></script>

    <script>
        // Test assessment submission
        async function testSubmission() {
            const statusDiv = document.getElementById('status');
            statusDiv.style.display = 'block';
            statusDiv.className = 'status';
            statusDiv.innerHTML = '<p>Testing submission...</p>';

            // Create test assessment data
            const testAssessment = {
                companyName: 'Test Company ' + Date.now(),
                contactName: 'Test User',
                contactEmail: 'test@example.com',
                contactRole: 'Test Role',
                industry: 'Technology',
                companySize: '50-200',
                maturityLevel: 'Intermediate',
                previousAssessment: 'Yes',
                recentIncidents: 'No',
                concerns: ['Data breach protection', 'Compliance'],
                services: ['Security Audit', 'Penetration Testing'],
                timeline: '1-3 months',
                budget: '$10,000-$25,000',
                additionalContext: 'This is a test submission to verify the system works',
                scheduleConsultation: 'Yes',
                assessmentScore: 75
            };

            try {
                // Submit via the same function used by the real form
                if (window.submitAssessmentSimple) {
                    const result = window.submitAssessmentSimple(testAssessment);

                    statusDiv.className = 'status success';
                    statusDiv.innerHTML = `
                        <h3>‚úÖ Submission Successful!</h3>
                        <p><strong>Submission ID:</strong> ${result.submissionId}</p>
                        <p><strong>Timestamp:</strong> ${new Date(result.submittedAt).toLocaleString()}</p>
                        <p>Data saved to:</p>
                        <ul>
                            <li>Local Storage ‚úÖ</li>
                            <li>Cloud Storage (JSONBin) - Processing...</li>
                            <li>Email Notification - Sending...</li>
                        </ul>
                        <p><strong>Check your email and admin dashboard!</strong></p>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    `;
                } else {
                    throw new Error('submitAssessmentSimple function not found');
                }
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = `
                    <h3>‚ùå Submission Failed</h3>
                    <p>Error: ${error.message}</p>
                `;
                console.error('Test submission error:', error);
            }
        }

        // Check cloud data
        async function checkCloudData() {
            const statusDiv = document.getElementById('status');
            statusDiv.style.display = 'block';
            statusDiv.className = 'status';
            statusDiv.innerHTML = '<p>Checking cloud data...</p>';

            try {
                if (window.getAllAssessments) {
                    const assessments = await window.getAllAssessments();

                    statusDiv.className = 'status success';
                    statusDiv.innerHTML = `
                        <h3>‚òÅÔ∏è Cloud Data Retrieved</h3>
                        <p><strong>Total Assessments:</strong> ${assessments.length}</p>
                        <p><strong>Latest 5 assessments:</strong></p>
                        <pre>${JSON.stringify(assessments.slice(0, 5), null, 2)}</pre>
                    `;
                } else {
                    throw new Error('getAllAssessments function not found');
                }
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = `
                    <h3>‚ùå Cloud Check Failed</h3>
                    <p>Error: ${error.message}</p>
                `;
                console.error('Cloud check error:', error);
            }
        }

        // Check local data
        function checkLocalData() {
            const statusDiv = document.getElementById('status');
            statusDiv.style.display = 'block';

            try {
                const localData = JSON.parse(localStorage.getItem('security_assessments') || '[]');

                statusDiv.className = 'status success';
                statusDiv.innerHTML = `
                    <h3>üíæ Local Storage Data</h3>
                    <p><strong>Total Local Assessments:</strong> ${localData.length}</p>
                    <p><strong>Latest 5 assessments:</strong></p>
                    <pre>${JSON.stringify(localData.slice(-5), null, 2)}</pre>
                `;
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = `
                    <h3>‚ùå Local Check Failed</h3>
                    <p>Error: ${error.message}</p>
                `;
                console.error('Local check error:', error);
            }
        }

        // Auto-check on load
        window.addEventListener('load', () => {
            console.log('Test page loaded');
            console.log('Available functions:', {
                submitAssessmentSimple: typeof window.submitAssessmentSimple,
                getAllAssessments: typeof window.getAllAssessments,
                sendAssessmentEmail: typeof window.sendAssessmentEmail
            });
        });
    </script>
</body>
</html>